<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Generar PDF</title>
    </head>
    <body>
        <h1>Crear Archivos PDF</h1>
        <br />

        <input type="text" placeholder="Escribeme" id="textoEscrito" /><br /><br />
        <input type="date" id="fecha" />

        <a href="javascript:genPDF()">Crear pdf</a>

        <a href="grifosTest.html">Ir a la Página 2</a>

        <h2>Seleccione las actividades</h2>
        <div>
            <input type="checkbox" id="faena" onclick="toggleHorario('faena', 'FAENA')" />
            FAENA<br />
            <input type="checkbox" id="despostada" onclick="toggleHorario('despostada', 'DESPOSTADA')" />
            DESPOSTADA<br />
            <input type="checkbox" id="cuarteo" onclick="toggleHorario('cuarteo', 'CUARTEO')" />
            CUARTEO<br />
            <input type="checkbox" id="saladero" onclick="toggleHorario('saladero', 'SALADERO')" />
            SALADERO<br />
        </div>

        <div id="horarios"></div>

        <h2>Lista de Actividades</h2>
        <ul id="lista-actividades"></ul>

        <button onclick="generatePccActivities()">Generar actividades PCC</button>
        <button onclick="generateRandomOrder()">Generar</button>

        <div id="output"></div>

        <script type="text/javascript">
            function generateHourOptions() {
                let options = "";
                for (let i = 0; i < 24; i++) {
                    options += `<option value="${i.toString().padStart(2, "0")}">${i
                        .toString()
                        .padStart(2, "0")}</option>`;
                }
                return options;
            }

            function generateMinuteOptions() {
                let options = "";
                for (let i = 0; i < 60; i += 5) {
                    // Incremento de 5 minutos
                    options += `<option value="${i.toString().padStart(2, "0")}">${i
                        .toString()
                        .padStart(2, "0")}</option>`;
                }
                return options;
            }

            function toggleHorario(id, name) {
                const checkbox = document.getElementById(id);
                const container = document.getElementById("horarios");

                if (checkbox.checked) {
                    const div = document.createElement("div");
                    div.className = "horario";
                    div.id = `horario-${id}`;
                    div.innerHTML = `
                        <h3>${name}</h3>
                        <label for="inicio-${id}">Hora de Inicio:</label>


                        <!--<select id="inicio-${id}"><option value="07">07</option></select>:<select id="inicio-min-${id}">${generateMinuteOptions()}</select>-->


                        <select id="inicio-${id}">${generateHourOptions()}</select>:<select id="inicio-min-${id}">${generateMinuteOptions()}</select>

                        <br>
                        <label for="fin-${id}">Hora de Finalización:</label>
                        <select id="fin-${id}"><option value="17">17</option></select>:<select id="fin-min-${id}">${generateMinuteOptions()}</select>   
                        
                        <!--<select id="fin-${id}">${generateHourOptions()}</select>:<select id="fin-min-${id}">${generateMinuteOptions()}</select>-->


                        <br>
                        <label>Tipo de Actividad:</label>
                        <input type="checkbox" id="preoperacional-${id}" value="Preoperacional"> Preoperacional
                        <input type="checkbox" id="operacional-${id}" value="Operacional"> Operacional
                        <br>
                        <button onclick="agregarActividad('${name}', 'inicio-${id}', 'inicio-min-${id}', 'fin-${id}', 'fin-min-${id}', 'preoperacional-${id}', 'operacional-${id}')">Agregar a la Lista</button>
                    `;
                    container.appendChild(div);
                } else {
                    const div = document.getElementById(`horario-${id}`);
                    if (div) {
                        container.removeChild(div);
                    }
                }
            }

            function agregarActividad(name, inicioId, inicioMinId, finId, finMinId, preoperacionalId, operacionalId) {
                const inicioHora = document.getElementById(inicioId).value;
                const inicioMin = document.getElementById(inicioMinId).value;
                const finHora = document.getElementById(finId).value;
                const finMin = document.getElementById(finMinId).value;

                const tipoActividad = [];
                if (document.getElementById(preoperacionalId).checked) tipoActividad.push("Preoperacional");
                if (document.getElementById(operacionalId).checked) tipoActividad.push("Operacional");

                const lista = document.getElementById("lista-actividades");
                const li = document.createElement("li");
                li.textContent = `${name}: De ${inicioHora}:${inicioMin} a ${finHora}:${finMin} (${tipoActividad.join(
                    ", "
                )})`;
                lista.appendChild(li);
            }
        </script>

        <script type="text/javascript">
            function formatTime(givenMinutes) {
                // Calculamos las horas y minutos
                let hours = Math.floor(givenMinutes / 60);
                let minutes = Math.floor(givenMinutes % 60);
                minutes = Math.round(minutes / 5) * 5 === 60 ? 0 : Math.round(minutes / 5) * 5;

                // Aseguramos que los valores tengan dos dígitos
                let formattedHours = hours.toString().padStart(2, "0");
                let formattedMinutes = minutes.toString().padStart(2, "0");

                // Formateamos en el formato hh:mm
                return `${formattedHours}:${formattedMinutes}`;
            }

            function arrayContadorDeDuplicados(arr) {
                // Objeto para almacenar la primera aparición de cada elemento
                let firstOccurrences = {};

                // Array resultado
                let result = [];

                for (let i = 0; i < arr.length; i++) {
                    let element = arr[i];

                    if (firstOccurrences[element] === undefined) {
                        // Si es la primera vez que aparece el elemento
                        firstOccurrences[element] = i;
                        result.push(1); // Añadimos 1 al resultado
                    } else {
                        // Si el elemento ya apareció antes
                        let firstIndex = firstOccurrences[element];
                        result.push(2); // Calculamos la diferencia de índices y añadimos al resultado
                    }
                }

                return result;
            }

            function generatePccActivities() {
                // Lista de elementos
                let pcc = ["1B", "2B", "3F", "4B"];
                let listaRegistros = [];
                let registroComponentes = [];

                // Agregar elemento al array aleatoriamente
                let max = pcc.length;
                let randomInt = Math.floor(Math.random() * max);
                pcc.push(pcc[randomInt]);

                // Ordenar aleatoriamente
                pcc.sort(() => Math.random() - 0.5);

                registroComponentes = arrayContadorDeDuplicados(pcc);

                let textoAnexto = "16/07/2024" + "<br>";
                let descripcion = "";

                const inicioHoraFaena = document.getElementById("inicio-faena").value;
                const inicioMinFaena = document.getElementById("inicio-min-faena").value;
                const finHoraFaena = document.getElementById("fin-faena").value;
                const finMinFaena = document.getElementById("fin-min-faena").value;
                // const inicioHoraDespostada = document.getElementById("inicio-despostada").value;
                // const inicioMinDespostada = document.getElementById("inicio-min-despostada").value;
                // const finHoraDespostada = document.getElementById("fin-despostada").value;
                // const finMinDespostada = document.getElementById("fin-min-despostada").value;

                let inicioFaenaEnMinutos = +inicioHoraFaena * 60 + +inicioMinFaena;
                let finFaenaEnMinutos = +finHoraFaena * 60 + +finMinFaena;
                let totalTrabajadoEnMinutos = finFaenaEnMinutos - inicioFaenaEnMinutos;
                let horarioActividadEnFAenaEnMinutos = inicioFaenaEnMinutos;

                for (let i = 0; i < pcc.length; i++) {
                    if (registroComponentes[i] != 1) {
                        descripcion = "Registro";
                    } else {
                        switch (pcc[i]) {
                            case "1B":
                                // Cantidad de medias reses revisadas
                                min = 9;
                                max = 12;
                                descripcion = Math.floor(Math.random() * (max - min + 1)) + min + " medias reses";
                                break;
                            case "2B":
                                descripcion = "Recorte bovino";
                                break;
                            case "3F":
                                descripcion = "Producto Final";
                                break;
                            case "4B":
                                descripcion = "Ácido lactico";
                                break;
                        }
                    }

                    //Generamos los minutos máximos y mínimos para sumar a la última hora que se hizo el PCC o al inicio de actividades.
                    //Mínimo = Una hora apróximadamente.
                    min = totalTrabajadoEnMinutos / 10;
                    //Máximo = La cantidad de PCC a los que se van en el recorrido.
                    max = totalTrabajadoEnMinutos / +pcc.length;
                    const espacioAleatoriosEntreRecorridos = Math.floor(Math.random() * (max - min + 1)) + min;
                    horarioActividadEnFAenaEnMinutos += espacioAleatoriosEntreRecorridos;

                    let planilla = new Object();
                    planilla.pcc = pcc[i];
                    planilla.hora = formatTime(horarioActividadEnFAenaEnMinutos);
                    planilla.componente = registroComponentes[i];
                    planilla.descripcion = descripcion;

                    listaRegistros.push(planilla);
                }

                for (let i = 0; i < pcc.length; i++) {
                    textoAnexto +=
                        listaRegistros[i].pcc +
                        "| " +
                        listaRegistros[i].hora +
                        " |" +
                        listaRegistros[i].componente +
                        "| " +
                        listaRegistros[i].descripcion +
                        " |" +
                        " ✓ " +
                        "<br>";
                }

                // Mostrar el resultado en el DOM
                let outputDiv = document.getElementById("output");
                outputDiv.innerHTML = textoAnexto;

                // outputDiv.textContent = algo +'Orden aleatorio: ' + pcc.join(', ');
            }
        </script>

        <script type="text/javascript" src="jspdf.min.js"></script>
        <script type="text/javascript">
            function genPDF() {
                var doc = new jsPDF();

                // Obtener el mensaje del elemento con ID 'textoEscrito'
                let mensaje = document.getElementById("textoEscrito").value;

                // Obtener la fecha seleccionada del elemento con ID 'fecha'
                let fechaSeleccionada = document.getElementById("fecha").value;
                if (!fechaSeleccionada) {
                    alert("Por favor, selecciona una fecha.");
                    return;
                }
                // Formatear la fecha seleccionada (yyyy-mm-dd a dd/mm/yyyy)
                let partesFecha = fechaSeleccionada.split("-");
                let fechaFormateada = partesFecha[2] + "/" + partesFecha[1] + "/" + partesFecha[0];

                //Generar numero del 0 al 11 y luego lo pasamos a minutos
                let max = 11;
                let randomInt = Math.floor(Math.random() * max);
                let minutosRandom = randomInt * 5;

                //Generar numero para las horas
                let min = 7;
                max = 15;
                randomInt = Math.floor(Math.random() * (max - min) + min);
                let horasRandom = randomInt * 5;

                let horarioGenerado = horasRandom + ":" + minutosRandom;

                // Añadir el mensaje y la fecha al PDF
                doc.text(20, 20, "Fecha: " + fechaFormateada);
                doc.text(20, 30, mensaje);
                doc.text(20, 40, mensaje);

                // Añadir una nueva página y un mensaje adicional
                doc.addPage();
                doc.text(20, 20, "Mi trabajo!!");

                // Agregar un párrafo al DOM con la información
                let outputDiv = document.getElementById("output");
                let nuevoParrafo = document.createElement("p");
                nuevoParrafo.textContent = `Mensaje: ${mensaje} - Fecha: ${fechaFormateada} - Horario ${horarioGenerado}`;
                outputDiv.appendChild(nuevoParrafo);

                // Guardar el PDF
                doc.save("Test.pdf");
            }
        </script>

        <!-- 
        <script type="text/javascript">
            // Función para generar las opciones de hora
            function generateHourOptions() {
                let hourSelect = document.getElementById("hour");
                for (let i = 0; i < 24; i++) {
                    let option = document.createElement("option");
                    option.value = i;
                    option.textContent = i.toString().padStart(2, "0");
                    hourSelect.appendChild(option);
                }
            }

            // Función para generar las opciones de minuto
            function generateMinuteOptions() {
                let minuteSelect = document.getElementById("minute");
                for (let i = 0; i < 60; i += 5) {
                    // Incremento de 5 minutos
                    let option = document.createElement("option");
                    option.value = i;
                    option.textContent = i.toString().padStart(2, "0");
                    minuteSelect.appendChild(option);
                }
            }

            // Llamar a las funciones para generar las opciones al cargar la página
            generateHourOptions();
            generateMinuteOptions();

            // Función para mostrar el horario seleccionado
            function showSelectedTime() {
                let hour = document.getElementById("hour").value;
                let minute = document.getElementById("minute").value;
                document.getElementById("selected-time").textContent =
                    hour + ":" + minute;
            }
        </script>-->

        <script type="text/javascript">
            function generateRandomOrder() {
                let horaInicio = 7;
                let max = 18;
                let min = 10;

                let minutosDecimalRandom = Math.floor(Math.random() * (max - min) + min) + 1;

                minutosDecimalRandom = (minutosDecimalRandom / 10) * 3600;

                function formatTime(seconds) {
                    // Calculamos las horas y minutos
                    let hours = Math.floor(seconds / 3600);
                    let minutes = Math.floor((seconds % 3600) / 60);
                    minutes = Math.round(minutes / 5) * 5;

                    // Aseguramos que los valores tengan dos dígitos
                    let formattedHours = hours.toString().padStart(2, "0");
                    let formattedMinutes = minutes.toString().padStart(2, "0");

                    // Formateamos en el formato hh:mm
                    return `${formattedHours}:${formattedMinutes}`;
                }
            }
        </script>
    </body>
</html>
